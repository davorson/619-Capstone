%% Use Load3 directly from workspace
t_training = Load3.Time;
signal_training = Load3.Data;

%% Ultra-clean filtering for Load3
sig = double(Load3.Data);
sig = sig(:);
sig = sig(~isnan(sig) & isfinite(sig));

%% Normalize to [0 1]
sig = rescale(sig,0,1);

%% Stage 1: Wavelet shrinkage
sig_stage1 = wdenoise(sig,6, ...
    'Wavelet','coif5', ...
    'DenoisingMethod','SURE', ...
    'ThresholdRule','Hard', ...
    'NoiseEstimate','LevelDependent');

%% Stage 2: Low-pass Butterworth filter
Fs = 1;          % sampling rate (adjust if needed)
Fc = 0.002;      % normalized cutoff

[b,a] = butter(4,Fc,'low');
sig_stage2 = filtfilt(b,a,sig_stage1);

%% Optional smoothing
sig_clean = smoothdata(sig_stage2,'movmean',100);

%% Rescale back to original Load3 range
sig_clean = rescale(sig_clean, min(Load3.Data), max(Load3.Data));

%% Simple store (so you can use it later)
Load3_filtered_train = sig_clean;
